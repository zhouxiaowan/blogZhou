---
title: 作用域
date: 2021-11-18 12:30:55
lastUpdated: 2021-11-18 12:30:55
---

# 作用域
## 4.1 作用域是什么
几乎所有的编程语言都可以储存变量中的值，并且能够在之后对这个值进行访问或修改。  
我们需要一套设计良好的规则来储存变量，并且之后可以方便的找到这些变量，这套规则被称为作用域
## 4.2 理解作用域
* 引擎：从头到尾负责整个Javascript程序的编译及执行过程
* 编译器：引擎的好朋友之一，负责语法分析及代码生成等脏活累活。
* 作用域：负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。

问题：分析`var a = 2`  
答：在当前作用域下声明变量`a`（如果之前没声明过），然后在作用域中查找`a`，并给它赋值为`2`  
详细分析：  
1. 遇到`var a`,编译器会询问作用域是否已经有一个该名称的变量存在于同一个作用域的集合中，如果是，编译器会忽略该声明，继续进行编译，否则它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为`a`
2. 接下来编译器会为引擎生成运行时所需要的代码，这些代码被用来处理`a=2`这个赋值操作。引擎运行时会首先询问作用域，在当前的作用域中是否存在一个叫做`a`的变量，如果有，引擎就使用这个变量，如果没有就会继续向上查找该变量。如果引擎找到了，就会将`2`赋值给它，否则抛出一个异常。
## 4.3 欺骗词法
词法作用域是完全由代码期间，__函数所声明的位置来定义__.但是特殊情况下也能在运行时来修改，也就是欺骗词法
1. __eval__  
eval(...)函数可以接受一个字符串为参数，并将其中的内容视为好像在书写时就存在于程序中的这个位置  
例题：
```js
function foo(str){
  eval(str)
  console.log(b) //3
}
foo("var b = 3")
```
eval 在foo内部创建了一个变量b，并遮蔽了外部的作用域中的同名变量。   
2. __with__
## 4.4 作用域分类
1. 全局作用域  
2. 函数作用域  
3. 块级作用域
## 4.5 变量提升
所有的声明（变量和函数）都会被移动到各自的作用域的最顶端，这个过程称为提升。
```js
function foo(){
  console.log(a)
  var a = 2
}
//变量提升
function foo(){
  var a // 变量提升
  console.log(a)
  a = 2
}
```
只有声明本身会被提升，而赋值操作或其它运行逻辑会留在原地（赋值）  
函数声明和变量声明都会被提升，但是函数提升优于变量提升，在代码中，函数会首先被提升，然后才是变量。  
```js
foo() // 1 // 函数提升先于变量提升
var foo
function foo(){
  console.log(1)
}
foo = function(){
  console.log(2)
}
```
后出现的函数声明会覆盖前面的  

参考：《你不知道的JavaScript》上册
