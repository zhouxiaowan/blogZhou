---
title: 传输层协议
date: 2021-11-23 17:23:50
---
# 传输层协议
目前传输层最广泛的协议是：TCP和UDP  

## 2.1 UDP

## 2.2 TCP
TCP（Transmission Control Protocol）是一种面向`连接`的、`可靠`的、基于字节流的传输层通信协议，提供Host-To-Host的可靠传输。  
* 连接：连接的目的是保证双方都在线，可以尽快的响应对方的请求。建立连接的过程就是握手过程，断开连接是挥手过程
* 可靠：指数据无损传输，发送方发送的数据和接收方接受的数据相同  

TCP 是一个`双工协议`，数据任何时候都可以双向传输。这就意味着客户端和服务端可以平等地发送、接收信息。正因为如此，客户端和服务端在 TCP 协议中有一个平等的名词——Host（主机）。
* 单工：任何一个时刻，数据只能单向发送
* 半双工：在某一时刻，数据可以向一个方向传输，也可以像相反的方向传输，而且交替进行
* 全双工：任何时刻数据都可以双向收发  

<font color="#3eaf7c">下面说一下三次握手和四次挥手的过程</font>  
首先先介绍下TCP中常见的标识位：  
  
* SYN:发起同步请求，1 表示 SYN 开启，0 表示关闭
* ACK:响应
* FIN:请求完成，一个HOST主动断开连接
* PSH：数据推送，一个HOST向另一个HOST发送数据
* RST：表示连接重置  

在SYN、PSH、FIN这三种情况下，接收方收到数据后都需要发送给对方一个`ACK`（响应）  
__建立连接的过程(三次握手)：__
  <img :src="$withBase('/images/woshou.png')" alt="三次握手"/>

* 步骤1是第一次握手，客户端消息给客户端要建立连接  
* 步骤2和步骤3是同时发生的，所以合并成一个SYN-ACK响应，作为一条数据发送给客户端，这是第二次握手
* 步骤4是第三次握手，针对服务端的SYN给个ACK（响应）

__断开连接的过程(四次挥手)：__
<img :src="$withBase('/images/huishou.png')" alt="四次挥手"/>

* 步骤1是第一次挥手，客户端消息给客户端发消息请求断开连接  
* 步骤2是第二次挥手，服务端根据客户端的FIN，给个ACK，作为FIN的响应
* 步骤3是第三次挥手，当服务端做好准备时发送一个FIN给客户端，表示确定可以断开连接了
* 步骤4是第四次挥手，客户端收到了服务端的FIN，当客户端处理完自己的事情后，发送一个ACK响应给服务端确定可以断开连接了  
你可能在想了，为什么挥手时，步骤2和步骤3为什么不像握手时一样合并成一个请求呢，因为断开连接要处理的问题比较多，比如服务端可能还有发送出去的消息没有得到ACK，也可能服务端自己有资源需要释放，因此不能将两条请求合并成一个。所以，经过一系列的准备，服务端确定可以关闭了再发送一个FIN给客户端
## 2.3 UDP和TCP对比
1. __目标差异__
* TCP的核心目标是提供可靠的网络传输
* UDP的目标是在提供报文交换能力基础上尽可能地简化协议，轻装上阵
2. __连接__
* TCP是面向连接的协议,在数据传输之前必须建立连接
* UDP是一个无连接的协议，数据随时都可以发送，只提供发送封包（Datagram）的能力
3. __可靠__
* TCP核心是在保证可靠性提供更好的服务，TCP需要三次握手建立连接，保证双方在线，能够收到数据。而且TCP有时间窗口持续收集无序的数据，直到这一批数据都可以合理的排序组成连续的结果
* UDP没有TCP的特性，它只管发送数据封包，也不需要ACK（响应），只要消息发送出去，不管成功与否
4. __流控技术__
TCP使用流控技术来确保发送方不会发送过多数据而使接收方不堪重负。TCP在`发送缓冲区`中存储数据，在`接受缓冲区`中接收数据，当应用程序准备就绪时，它将从接受缓冲区读取数据。如果`接受缓冲区`已满，接收方将无法处理更多的数据，并将其丢弃。而UDP没有这方面的能力。  
5. __传输速度__
UDP协议简单，封包小，没有连接可靠性检查，单纯从速度上看，UDP更快
6. __场景差异__
* TCP 每个数据封包都需要确认因此不适应高速数据传输场景，例如直播、音视频传输、网络游戏等等；适用于点对点文件传出（微信等）、邮件、远程控制等
* UDP 适用于网络游戏、音视频传输、直播、DNS、RTP（实时传输协议）
* 模糊地带：HTTP（目前以 TCP 为主），http2使用的是TCP，http3开始使用UDP



